<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book New Service</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2 class="logo">LocalEase</h2>
        <ul>
            <li onclick="location.href='user-dashboard.html'">Dashboard</li>
            <li class="active">Book Service</li>
            <li onclick="location.href='my-requests.html'">My Bookings</li>
            <li onclick="logout()" class="logout">Logout</li>
        </ul>
    </aside>

    <!-- Main content -->
    <main class="main">
        <h1>Book New Service</h1>

        <form id="bookForm" method="POST">
            <input type="hidden" name="user_id" id="user_id">

            <label>Service:</label>
            <select name="service_id" required>
                <option value="">Select Service</option>
                <option value="1">Home Cleaning</option>
                <option value="2">Plumbing Repair</option>
                <option value="3">Electrical Repair</option>
            </select>

            <label>Date:</label>
            <input type="date" name="booking_date" required>

            <label>Time:</label>
            <select name="booking_time" required>
                <option value="">Select Time</option>
                <option value="08:00 AM">08:00 AM</option>
                <option value="09:00 AM">09:00 AM</option>
                <option value="10:00 AM">10:00 AM</option>
                <option value="11:00 AM">11:00 AM</option>
                <option value="12:00 PM">12:00 PM</option>
                <option value="01:00 PM">01:00 PM</option>
                <option value="02:00 PM">02:00 PM</option>
                <option value="03:00 PM">03:00 PM</option>
                <option value="04:00 PM">04:00 PM</option>
            </select>

            <button type="submit">Book Service</button>
        </form>
    </main>

</div>

<script>
    // Get user info
    const token = localStorage.getItem("token");
    const role = localStorage.getItem("role");
    const user_id = localStorage.getItem("userid");

    if (!token || role !== "user") {
        window.location.href = "login.html";
    }

    document.getElementById("user_id").value = user_id;

    function logout() {
        localStorage.removeItem("token");
        localStorage.removeItem("role");
        localStorage.removeItem("userId");
        window.location.href = "login.html";
    }

    // Submit form
    const form = document.getElementById("bookForm");
    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const data = {
            user_id: document.getElementById("user_id").value,
            service_id: form.service_id.value,
            booking_date: form.booking_date.value,
            booking_time: form.booking_time.value
        };

        console.log(data); // Check data being sent

        fetch("/users/book-service", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(res => {
            if(res.success) {
                Swal.fire("Success", res.success, "success");
                form.reset();
            } else {
                Swal.fire("Error", res.error || "Booking failed", "error");
            }
        })
        .catch(err => {
            console.error(err);
            Swal.fire("Error", "Something went wrong", "error");
        });
    });
</script>

</body>
</html>